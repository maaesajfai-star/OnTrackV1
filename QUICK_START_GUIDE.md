# OnTrack Dependency Update - Quick Start Guide

**Last Updated:** January 1, 2026

---

## Immediate Action Required

Your OnTrack platform has **19 security vulnerabilities** including **1 CRITICAL** issue (CVSS 9.1). Follow these steps to secure your application.

---

## Step 1: Review the Situation (2 minutes)

Read the executive summary:
```bash
cat /home/mahmoud/AI/Projects/claude-Version1/DEPENDENCY_AUDIT_EXECUTIVE_SUMMARY.md
```

**Key Points:**
- 1 CRITICAL vulnerability (Next.js auth bypass)
- 13 HIGH severity vulnerabilities
- All fixes ready to install
- Minimal breaking changes (5-10 min to fix)

---

## Step 2: Automatic Installation (10-15 minutes)

Run the automated installation script:

```bash
cd /home/mahmoud/AI/Projects/claude-Version1

# Make script executable
chmod +x install-updates.sh

# Run installation
./install-updates.sh
```

**What it does:**
1. Backs up current package-lock.json files
2. Removes old node_modules
3. Installs updated dependencies
4. Tests compilation
5. Runs security audit
6. Generates installation report

---

## Step 3: Fix Breaking Changes (5-10 minutes)

### Frontend: Update Zustand Imports

Find all Zustand store files:
```bash
cd /home/mahmoud/AI/Projects/claude-Version1/frontend
grep -r "import create from 'zustand'" src/
```

Update each file:
```typescript
// Change this:
import create from 'zustand';

// To this:
import { create } from 'zustand';
```

**Quick fix (all files at once):**
```bash
find frontend/src -type f -name "*.ts" -o -name "*.tsx" | \
xargs sed -i "s/import create from 'zustand'/import { create } from 'zustand'/g"
```

---

## Step 4: Test Locally (10-15 minutes)

### Backend Test

```bash
cd /home/mahmoud/AI/Projects/claude-Version1/backend

# Build
npm run build

# Start dev server
npm run start:dev

# Verify API responds
curl http://localhost:3000/api/health
```

### Frontend Test

```bash
cd /home/mahmoud/AI/Projects/claude-Version1/frontend

# Build
npm run build

# Start dev server
npm run dev

# Open browser
open http://localhost:3001
```

### Critical Tests

1. **Authentication:** Login/logout works
2. **API Calls:** Data loads correctly
3. **Forms:** Submit and validation work
4. **File Uploads:** If used in your app
5. **Charts:** If using recharts

---

## Step 5: Deploy to Staging (Optional but Recommended)

```bash
# Build production images
cd /home/mahmoud/AI/Projects/claude-Version1

# Backend
cd backend
npm run build

# Frontend
cd ../frontend
npm run build

# Deploy to staging environment
# (Your deployment process here)
```

---

## Step 6: Production Deployment

### Option A: Docker Compose (Recommended)

```bash
cd /home/mahmoud/AI/Projects/claude-Version1

# Rebuild containers
docker-compose build

# Deploy with zero downtime
docker-compose up -d
```

### Option B: Manual Deployment

```bash
# Backend
cd backend
npm run build
pm2 restart backend

# Frontend
cd ../frontend
npm run build
pm2 restart frontend
```

---

## Verification Checklist

After deployment, verify:

- [ ] Backend API responds (HTTP 200)
- [ ] Frontend loads without errors
- [ ] Authentication works
- [ ] Database connections work
- [ ] No console errors
- [ ] npm audit shows 0 vulnerabilities

---

## Rollback (If Needed)

If something goes wrong:

```bash
cd /home/mahmoud/AI/Projects/claude-Version1

# Find backup directory
ls -lt dependency-backup-*

# Restore package-lock.json
BACKUP_DIR="dependency-backup-YYYYMMDD-HHMMSS"  # Use actual directory name

# Backend
cp $BACKUP_DIR/backend-package-lock.json backend/package-lock.json
cd backend
npm ci

# Frontend
cp $BACKUP_DIR/frontend-package-lock.json frontend/package-lock.json
cd ../frontend
npm ci
```

---

## Troubleshooting

### Issue: Build fails with TypeScript errors

**Solution:**
```bash
# Clear TypeScript cache
rm -rf node_modules/.cache
rm -rf .next

# Rebuild
npm run build
```

### Issue: Zustand import errors

**Solution:**
```bash
# Check for remaining old imports
grep -r "import create from 'zustand'" src/

# Fix manually or use sed command from Step 3
```

### Issue: NestJS compilation errors

**Solution:**
```bash
# Clear NestJS cache
rm -rf dist

# Rebuild
npm run build
```

### Issue: npm audit still shows vulnerabilities

**Solution:**
```bash
# Force update
npm audit fix --force

# If that doesn't work, check which packages:
npm audit --json | jq '.vulnerabilities'
```

---

## Getting Help

1. **Check detailed reports:**
   - `SECURITY_AUDIT_REPORT.md` - Vulnerability details
   - `DEPENDENCY_UPDATE_MIGRATION_GUIDE.md` - Full migration guide
   - `PERFORMANCE_OPTIMIZATION_REPORT.md` - Performance tips

2. **Installation issues:**
   - Check `installation-report-*.txt` generated by install script
   - Review npm error logs

3. **Runtime issues:**
   - Check application logs
   - Review browser console
   - Verify environment variables

---

## Expected Timeline

| Phase | Duration | Description |
|-------|----------|-------------|
| Review | 2-5 min | Read executive summary |
| Install | 10-15 min | Run install script |
| Fix | 5-10 min | Update Zustand imports |
| Test | 10-15 min | Local testing |
| Deploy | 15-30 min | Staging deployment |
| Production | 30-60 min | Production deployment |
| **Total** | **1-2 hours** | Complete process |

---

## Files Reference

### Package Files (Updated)
- `/home/mahmoud/AI/Projects/claude-Version1/backend/package.json`
- `/home/mahmoud/AI/Projects/claude-Version1/frontend/package.json`

### Documentation
- `/home/mahmoud/AI/Projects/claude-Version1/DEPENDENCY_AUDIT_EXECUTIVE_SUMMARY.md`
- `/home/mahmoud/AI/Projects/claude-Version1/SECURITY_AUDIT_REPORT.md`
- `/home/mahmoud/AI/Projects/claude-Version1/DEPENDENCY_UPDATE_MIGRATION_GUIDE.md`
- `/home/mahmoud/AI/Projects/claude-Version1/PERFORMANCE_OPTIMIZATION_REPORT.md`

### Scripts
- `/home/mahmoud/AI/Projects/claude-Version1/install-updates.sh`

---

## Success Criteria

You're done when:

- [x] Install script completed successfully
- [ ] Backend builds without errors
- [ ] Frontend builds without errors
- [ ] Backend starts and responds to requests
- [ ] Frontend loads in browser
- [ ] npm audit shows 0 high/critical vulnerabilities
- [ ] All critical features work (auth, API, forms)
- [ ] Production deployment successful

---

## One-Liner Install (For the Brave)

```bash
cd /home/mahmoud/AI/Projects/claude-Version1 && \
chmod +x install-updates.sh && \
./install-updates.sh && \
find frontend/src -type f \( -name "*.ts" -o -name "*.tsx" \) -exec sed -i "s/import create from 'zustand'/import { create } from 'zustand'/g" {} + && \
cd backend && npm run build && \
cd ../frontend && npm run build && \
echo "âœ… Update complete! Review output above for any errors."
```

**Use with caution!** Better to follow step-by-step for first time.

---

## Post-Deployment

After successful deployment:

1. **Monitor for 24-48 hours:**
   - Error rates
   - Response times
   - User reports

2. **Update documentation:**
   - Mark deployment as complete
   - Document any issues encountered

3. **Schedule follow-up:**
   - Review performance metrics
   - Plan next dependency audit (monthly)

4. **Celebrate:**
   - You've eliminated 19 security vulnerabilities!
   - Platform is now production-ready and secure!

---

**Questions?** Review the detailed documentation files listed above.

**Need help?** Contact the OnTrack development team.

**Ready?** Start with Step 1!
